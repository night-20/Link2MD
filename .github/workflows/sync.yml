name: 同步到极狐 GitLab

on:
  push:
    branches:
      - '**'        # 所有分支推送时触发
    tags:
      - '**'        # 所有标签推送时触发
  delete:           # 删除分支/标签时也同步删除

jobs:
  sync-to-jihulab:
    name: Mirror to JihuLab
    runs-on: ubuntu-latest

    steps:
      - name: 检出完整仓库（含所有分支和标签）
        uses: actions/checkout@v4
        with:
          fetch-depth: 0        # 拉取完整历史，不做浅克隆

      - name: 同步推送到极狐 GitLab
        env:
          # 在 GitHub 仓库 Settings → Secrets → Actions 中添加：
          # JIHULAB_TOKEN：极狐 GitLab 个人访问令牌（需要 write_repository 权限）
          JIHULAB_TOKEN: ${{ secrets.JIHULAB_TOKEN }}
        run: |
          # 配置 git 用户信息
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git config user.name  "github-actions[bot]"

          # 将极狐仓库添加为远程源
          git remote add jihulab \
            "https://oauth2:${JIHULAB_TOKEN}@jihulab.com/night-20-group/Link2MD.git"

          # 推送所有分支和标签（--mirror 会同步删除操作）
          git push --mirror jihulab
